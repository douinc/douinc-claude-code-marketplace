---
description: Review and optimize CLAUDE.md files
argument-hint: [--health | --fix | path]
allowed-tools: Read, Write, Bash(wc:*, find:*, grep:*)
---

Review CLAUDE.md (or AGENTS.md) files following context engineering best practices.

## Arguments

- `--health`: Quick health score only (no detailed analysis)
- `--fix`: Apply automatic fixes and rewrite CLAUDE.md
- `path`: Specific directory to review (default: current working directory)

## Execution

### Step 1: Locate CLAUDE.md

Look for CLAUDE.md in the target directory. If not found, check for AGENTS.md.
If neither exists, report "No CLAUDE.md or AGENTS.md found" and exit.

### Step 2: Read and Analyze

Read the file and evaluate against these criteria:

**Metrics to calculate:**
- Total lines
- Estimated instruction count (count imperative sentences, bullet points with directives)
- Number of code snippets (`<code-snippet>`, triple backticks with code)
- Presence of WHAT section (tech stack, structure)
- Presence of WHY section (project purpose)
- Presence of HOW section (commands, workflows)
- Progressive disclosure (references to external docs like `agent_docs/`, `docs/`)
- Auto-generated markers (`<laravel-boost-guidelines>`, "Generated by", `/init`)

**Scoring (start at 100, deduct):**
- Lines > 300: -1 per 10 lines over
- Lines > 100: -0.5 per 10 lines over 100
- Instructions > 50: -1 per instruction over
- Each code snippet: -3
- Style guidelines present: -10
- Missing WHAT: -10
- Missing WHY: -10
- Missing HOW: -10
- No progressive disclosure: -10
- Auto-generated detected: -15
- Task-specific instructions: -5 each (max -15)

### Step 3: Output Based on Flag

**If `--health`:**

Output ONLY this format:
```
ğŸ“Š CLAUDE.md Health: [project-name]

Score: XX/100 [ğŸŸ¢|ğŸŸ¡|ğŸŸ |ğŸ”´|â›”]

Lines:         XX / 300   [âœ…|ğŸŸ¡|âŒ]
Instructions:  XX / 50    [âœ…|ğŸŸ¡|âŒ]
Code snippets: X          [âœ…|âŒ]
Has WHAT:      [Yes|No]   [âœ…|âŒ]
Has WHY:       [Yes|No]   [âœ…|âŒ]
Has HOW:       [Yes|No]   [âœ…|âŒ]
Progressive:   [Yes|No]   [âœ…|âŒ]
Auto-generated:[Yes|No]   [âœ…|âŒ]
```

Score emoji:
- 90-100: ğŸŸ¢
- 70-89: ğŸŸ¡
- 50-69: ğŸŸ 
- 30-49: ğŸ”´
- 0-29: â›”

**If no flag (full review):**

Output:
```markdown
## CLAUDE.md Review: [project-name]

### Summary
- Lines: X (target: < 300)
- Estimated instructions: ~Y
- Score: Z/100

### Issues Found

#### ğŸ”´ Critical
[List critical issues]

#### ğŸŸ¡ Warnings
[List warnings]

#### ğŸ’¡ Suggestions
[List improvement ideas]

### Recommended Structure
[Suggest directory structure if applicable]

### Suggested Rewrite
[Provide a concise rewritten version]
```

**If `--fix`:**

1. First show the current score
2. Propose the rewritten CLAUDE.md
3. Ask for confirmation
4. If confirmed, write the new file
5. Show before/after scores

## Best Practices Reference

Read `docs/best-practices.md` in this plugin directory for the full guidelines.

Key principles:
- **Less is more** - Target < 50 instructions, < 100 lines ideal
- **Universal applicability** - Only include what matters for EVERY task
- **Progressive disclosure** - Point to detailed docs, don't duplicate
- **Prefer pointers to copies** - Use file:line references, not code snippets
- **Never use LLM as linter** - Use proper tooling for style enforcement
- **Don't auto-generate** - CLAUDE.md is highest leverage, craft it carefully
